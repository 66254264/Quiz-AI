# 速率限制说明

## 当前配置

### 开发环境（NODE_ENV !== 'production'）
- **通用限制器**: 15分钟内 1000 次请求
- **认证限制器**: 1分钟内 20 次请求（仅计算失败的请求）
- **提交限制器**: 5分钟内 50 次提交
- **题目创建限制器**: 1分钟内 50 次创建
- **统计查询限制器**: 1分钟内 100 次查询

### 生产环境（NODE_ENV === 'production'）
- **通用限制器**: 15分钟内 100 次请求
- **认证限制器**: 1分钟内 5 次请求（仅计算失败的请求）
- **提交限制器**: 5分钟内 10 次提交
- **题目创建限制器**: 1分钟内 10 次创建
- **统计查询限制器**: 1分钟内 30 次查询

## 如果遇到速率限制问题

### 方法 1: 重启后端服务
速率限制存储在内存中，重启服务会清除所有限制：
```bash
# 停止当前服务（Ctrl+C）
# 然后重新启动
cd backend
npm run dev
```

### 方法 2: 等待限制窗口过期
- 通用限制器: 等待 15 分钟
- 认证限制器: 等待 1 分钟
- 其他限制器: 根据具体配置等待

### 方法 3: 设置环境变量
确保在开发时 NODE_ENV 未设置为 'production'：
```bash
# 检查当前环境
echo $NODE_ENV

# 如果是 production，取消设置
unset NODE_ENV
```

## 调试技巧

查看响应头中的速率限制信息：
- `RateLimit-Limit`: 限制的最大请求数
- `RateLimit-Remaining`: 剩余可用请求数
- `RateLimit-Reset`: 限制重置的时间戳

## 注意事项

1. 认证限制器使用 `skipSuccessfulRequests: true`，只计算失败的登录尝试
2. 所有限制器基于 IP 地址
3. 在反向代理后面时，确保设置了 `trust proxy`（已在 server.ts 中配置）
